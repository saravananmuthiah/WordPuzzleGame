<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="WordPuzzleGame.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:WordPuzzleGame.ViewModels"
    Title="Word Puzzle">

    <ContentPage.BindingContext>
        <vm:WordPuzzleViewModel />
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Light theme -->
            <Style x:Key="TopicLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="#4e8cff" />
            </Style>
            <Style x:Key="TileBorderStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="#e0e7ff" />
                <Setter Property="Stroke" Value="#4e8cff" />
            </Style>
            <Style x:Key="DropBorderStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="#fff7e6" />
                <Setter Property="Stroke" Value="#ffb84e" />
            </Style>
            <Style x:Key="MainPageBackground" TargetType="ContentPage">
                <Setter Property="BackgroundColor" Value="White" />
            </Style>
            <!-- Dark theme -->
            <Style x:Key="TopicLabelStyleDark" TargetType="Label">
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="#90c4ff" />
            </Style>
            <Style x:Key="TileBorderStyleDark" TargetType="Border">
                <Setter Property="BackgroundColor" Value="#1a2233" />
                <Setter Property="Stroke" Value="#90c4ff" />
            </Style>
            <Style x:Key="DropBorderStyleDark" TargetType="Border">
                <Setter Property="BackgroundColor" Value="#2a2a2a" />
                <Setter Property="Stroke" Value="#ffd580" />
            </Style>
            <Style x:Key="MainPageBackgroundDark" TargetType="ContentPage">
                <Setter Property="BackgroundColor" Value="#181818" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <!-- Beautiful background image -->
        <Image Source="dotnet_bot.png"
               Aspect="AspectFill"
               Opacity="0.25"
               IsVisible="True"
               VerticalOptions="FillAndExpand"
               HorizontalOptions="FillAndExpand"
               ZIndex="0" />

        <ScrollView ZIndex="1">
            <VerticalStackLayout
                Padding="30,0"
                Spacing="25"
                VerticalOptions="Center">
                <!-- Topic label -->
                <Label
                    Text="{Binding SelectedTopic, StringFormat='Topic: {0}'}"
                    Style="{AppThemeBinding Light={StaticResource TopicLabelStyle}, Dark={StaticResource TopicLabelStyleDark}}"
                    HorizontalOptions="Center"
                    Margin="0,10,0,0" />

                <!--  Shuffled letters as draggable tiles  -->
                <HorizontalStackLayout
                    x:Name="TilesPanel"
                    Margin="0,10,0,10"
                    HorizontalOptions="Center"
                    Spacing="40"
                    HeightRequest="80">
                    <CollectionView
                        ItemsLayout="HorizontalList"
                        ItemsSource="{Binding ShuffledWordTiles}"
                        SelectionMode="None"
                        HeightRequest="66">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,10,0"
                                    Padding="10,0,10,10"
                                    Style="{AppThemeBinding Light={StaticResource TileBorderStyle}, Dark={StaticResource TileBorderStyleDark}}"
                                    HeightRequest="66"
                                    VerticalOptions="End"
                                    WidthRequest="56">
                                    <Border.StrokeThickness>1</Border.StrokeThickness>
                                    <Label
                                        FontSize="36"
                                        HorizontalOptions="Center"
                                        Text="{Binding .}"
                                        VerticalOptions="End" />
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding BindingContext.TileTapCommand, Source={x:Reference Name=TilesPanel}}" CommandParameter="{Binding .}" />
                                    </Border.GestureRecognizers>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </HorizontalStackLayout>

                <!--  Drop area for answer  -->
                <HorizontalStackLayout
                    x:Name="DropPanel"
                    Margin="0,10,0,10"
                    HorizontalOptions="Center"
                    Spacing="20"
                    HeightRequest="80">
                    <!--  Increased spacing from 10 to 20  -->
                    <CollectionView
                        ItemsLayout="HorizontalList"
                        ItemsSource="{Binding UserTiles}"
                        SelectionMode="None"
                        HeightRequest="66">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,10,0"
                                    Padding="10,0,10,10"
                                    Style="{AppThemeBinding Light={StaticResource DropBorderStyle}, Dark={StaticResource DropBorderStyleDark}}"
                                    HeightRequest="66"
                                    VerticalOptions="End"
                                    WidthRequest="56">
                                    <Border.StrokeThickness>1</Border.StrokeThickness>
                                    <Label
                                        FontSize="36"
                                        HorizontalOptions="Center"
                                        Text="{Binding .}"
                                        VerticalOptions="End" />
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </HorizontalStackLayout>

                <HorizontalStackLayout HorizontalOptions="Center" Spacing="10" HeightRequest="64">
                    <Label
                        FontSize="16"
                        HorizontalOptions="Start"
                        Text="{Binding Hint}"
                        TextColor="Gray"
                        FontAttributes="Italic"
                        LineBreakMode="WordWrap"
                        MaxLines="4"
                        WidthRequest="260"
                        VerticalOptions="Center" />
                    <ImageButton
                        Source="refresh.png"
                        HeightRequest="28"
                        WidthRequest="28"
                        BackgroundColor="Transparent"
                        Command="{Binding RefreshHintCommand}"
                        IsVisible="{Binding Hint, Converter={StaticResource StringToOpacityConverter}}"
                        IsEnabled="{Binding IsHintAvailable}"
                        VerticalOptions="Center"
                        Margin="10,0,0,0" />
                </HorizontalStackLayout>

                <Button
                    Text="Back to Topic Selection"
                    Command="{Binding GoToTopicSelectionCommand}"
                    HorizontalOptions="Center"
                    Margin="0,10,0,0"
                    HeightRequest="40"
                    WidthRequest="220"
                    FontSize="14"
                    BackgroundColor="#e0e7ff"
                    TextColor="#4e8cff"
                    CornerRadius="20"
                    />

                <!--  Feedback message  -->
                <Label
                    Margin="0,20,0,0"
                    FontSize="20"
                    HorizontalOptions="Center"
                    Opacity="{Binding Message, Converter={StaticResource StringToOpacityConverter}}"
                    Text="{Binding Message}"
                    TextColor="{Binding IsSuccess, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Green,Red'}"
                    HeightRequest="36" />
</VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>
